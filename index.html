<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rectangle Partitions — Click-to-Use</title>
  <style>
    :root{
      --bg:#0b0b0b; --fg:#f5f5f5; --muted:#bdbdbd; --surface:#161616; --card:#1e1e1e; --accent:#3a86ff;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
    }
    body{margin:0; background:var(--bg); color:var(--fg); font-family:var(--font); padding:16px; display:flex; flex-direction:column; gap:14px}
    h1{margin:0 0 6px; font-size:22px}
    .row{display:grid; grid-template-columns:320px 1fr; gap:16px}
    @media (max-width:900px){ .row{grid-template-columns:1fr} }
    .card{background:var(--card); border:1px solid #2a2a2a; border-radius:14px; padding:12px}
    .controls{display:flex; flex-wrap:wrap; gap:8px; align-items:center}
    .btn{background:var(--surface); color:var(--fg); border:1px solid #2a2a2a; border-radius:10px; padding:8px 12px; cursor:pointer}
    label{font-size:14px; color:var(--muted)}
    input[type="text"]{background:var(--surface); color:var(--fg); border:1px solid #2a2a2a; border-radius:10px; padding:8px 10px}
    .canvas-card{position:relative}
    #field{width:100%; height:520px; background:var(--surface); border-radius:12px; border:1px solid #2a2a2a; display:block}
    .floating{position:absolute; right:12px; top:12px; display:flex; flex-direction:column; gap:8px}
    .chips{display:flex; gap:10px; margin-top:8px; color:var(--muted); flex-wrap:wrap}
    .chip{background:var(--surface); border:1px solid #2a2a2a; border-radius:999px; padding:6px 10px}
    .note{color:var(--muted); font-size:13px}
  </style>
</head>
<body>
  <h1>Rectangle Partitions — Click-to-Use</h1>

  <div class="row">
    <div class="card">
      <div class="controls">
        <label>Expression (W × H):
          <input id="expr" type="text" value="6 x 4" aria-label="Rectangle expression">
        </label>
        <button id="applyExpr" class="btn">Set Rectangle</button>
      </div>

      <div class="controls">
        <label><input id="toggleTheme" type="checkbox"> Black on White</label>
        <label><input id="toggleDots" type="checkbox" checked> Show Dots</label>
        <button id="toggleAreas" class="btn">Show/Hide Areas</button>
        <button id="resetPartitions" class="btn">Clear Partitions</button>
      </div>

      <label>Write expression for the rectangle:
        <input id="exprLabel" type="text" value="6 × 4" aria-label="Expression label">
      </label>
      <p class="note" style="margin-top:6px">
        Click <b>Draw Partition</b>, then click once inside the field to place a vertical or horizontal cut at the nearest grid line.
        The button must be pressed again for each new partition.
      </p>
    </div>

    <div class="card canvas-card">
      <canvas id="field" width="1000" height="520" aria-label="Partition field"></canvas>
      <div class="floating">
        <button id="drawPartition" class="btn" title="Arm a single cut">Draw Partition</button>
        <button id="showProduct" class="btn" title="Toggle overall product">Show W×H</button>
      </div>
      <div id="axis" class="chips" aria-live="polite"></div>
    </div>
  </div>

  <script>
    const field = document.getElementById('field');
    const ctx = field.getContext('2d');
    let W=6, H=4;
    let showDots = true, lightTheme = false;
    let drawArmed = false; // click-to-use (one cut per press)
    let showAreas = false, showProductOnly = false;

    const vCuts = new Set(); // 1..W-1
    const hCuts = new Set(); // 1..H-1

    function parseExpr(t){
      const m = t.toLowerCase().replace(/×/g,'x').match(/(\d+)\s*[x*]\s*(\d+)/);
      return m ? {w:Math.max(1,parseInt(m[1],10)), h:Math.max(1,parseInt(m[2],10))} : null;
    }
    function geom(){
      const pad=28, width=field.width-pad*2, height=field.height-pad*2;
      return {pad,width,height,cw:width/W,ch:height/H};
    }
    function draw(){
      ctx.clearRect(0,0,field.width,field.height);
      ctx.fillStyle = lightTheme ? '#ffffff' : '#0f0f10';
      ctx.fillRect(0,0,field.width,field.height);

      const {pad,width,height,cw,ch} = geom();

      // border
      ctx.strokeStyle = lightTheme ? '#c9c9c9' : '#2a2a2a';
      ctx.lineWidth = 2;
      ctx.strokeRect(pad,pad,width,height);

      // dots
      if(showDots){
        ctx.fillStyle = lightTheme ? '#101010' : '#f0f0f0';
        for(let r=0;r<=H;r++){
          for(let c=0;c<=W;c++){
            ctx.beginPath(); ctx.arc(pad+c*cw, pad+r*ch, 2, 0, Math.PI*2); ctx.fill();
          }
        }
      }
      // grid
      ctx.strokeStyle = lightTheme ? '#d8d8d8' : '#262626'; ctx.lineWidth = 1;
      for(let r=1;r<H;r++){ const y=pad+r*ch; ctx.beginPath(); ctx.moveTo(pad,y); ctx.lineTo(pad+width,y); ctx.stroke(); }
      for(let c=1;c<W;c++){ const x=pad+c*cw; ctx.beginPath(); ctx.moveTo(x,pad); ctx.lineTo(x,pad+height); ctx.stroke(); }

      // partitions (thicker blue)
      ctx.strokeStyle = '#1e90ff'; ctx.lineWidth = 3;
      hCuts.forEach(r=>{ const y=pad+r*ch; ctx.beginPath(); ctx.moveTo(pad,y); ctx.lineTo(pad+width,y); ctx.stroke(); });
      vCuts.forEach(c=>{ const x=pad+c*cw; ctx.beginPath(); ctx.moveTo(x,pad); ctx.lineTo(x,pad+height); ctx.stroke(); });

      // areas overlay
      if(showAreas){
        const v=[0,...Array.from(vCuts).sort((a,b)=>a-b),W];
        const h=[0,...Array.from(hCuts).sort((a,b)=>a-b),H];
        ctx.fillStyle = lightTheme ? '#111' : '#eaeaea';
        ctx.font = '600 16px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto';
        ctx.textAlign='center'; ctx.textBaseline='middle';
        for(let i=0;i<h.length-1;i++){
          for(let j=0;j<v.length-1;j++){
            const w=v[j+1]-v[j], hh=h[i+1]-h[i];
            const x=pad+(v[j]+w/2)*cw, y=pad+(h[i]+hh/2)*ch;
            ctx.fillText(`${w}×${hh} = ${w*hh}`, x, y);
          }
        }
      }
      if(showProductOnly){
        ctx.fillStyle = lightTheme ? '#111' : '#eaeaea';
        ctx.font = '700 18px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto';
        ctx.textAlign='left'; ctx.textBaseline='alphabetic';
        ctx.fillText(`Product: ${W}×${H} = ${W*H}`, 12, field.height-12);
      }
      renderChips();
    }
    function renderChips(){
      const axis = document.getElementById('axis'); axis.innerHTML='';
      const v=[0,...Array.from(vCuts).sort((a,b)=>a-b),W];
      const h=[0,...Array.from(hCuts).sort((a,b)=>a-b),H];
      const wParts=[], hParts=[];
      for(let i=0;i<v.length-1;i++) wParts.push(v[i+1]-v[i]);
      for(let i=0;i<h.length-1;i++) hParts.push(h[i+1]-h[i]);
      const wEl=document.createElement('div'); wEl.className='chip'; wEl.textContent=`Width: ${wParts.join(' + ')}`;
      const hEl=document.createElement('div'); hEl.className='chip'; hEl.textContent=`Height: ${hParts.join(' + ')}`;
      const ex=document.createElement('div'); ex.className='chip'; ex.textContent=`Expression: ${document.getElementById('exprLabel').value}`;
      axis.appendChild(wEl); axis.appendChild(hEl); axis.appendChild(ex);
    }
    function nearestCut(x,y){
      const {pad,width,height,cw,ch} = geom();
      if(x<pad||x>pad+width||y<pad||y>pad+height) return null;
      const colPos=(x-pad)/cw, rowPos=(y-pad)/ch;
      const cN=Math.round(colPos), rN=Math.round(rowPos);
      const dx=Math.abs(colPos-cN)*cw, dy=Math.abs(rowPos-rN)*ch;
      if(dx<dy){ if(cN>0&&cN<W) return {type:'v',index:cN}; }
      else{ if(rN>0&&rN<H) return {type:'h',index:rN}; }
      return null;
    }

    field.addEventListener('click', (e)=>{
      if(!drawArmed) return; // must press each time
      const rect = field.getBoundingClientRect();
      const x=(e.clientX-rect.left)*(field.width/rect.width);
      const y=(e.clientY-rect.top)*(field.height/rect.height);
      const cut=nearestCut(x,y);
      if(cut){ if(cut.type==='v') vCuts.add(cut.index); if(cut.type==='h') hCuts.add(cut.index); }
      drawArmed=false; draw();
    });

    // UI
    document.getElementById('applyExpr').addEventListener('click', ()=>{
      const p=parseExpr(document.getElementById('expr').value); if(!p) return;
      W=p.w; H=p.h; vCuts.clear(); hCuts.clear(); showAreas=false; showProductOnly=false; draw();
    });
    document.getElementById('toggleTheme').addEventListener('change', e=>{ lightTheme=e.target.checked; draw(); });
    document.getElementById('toggleDots').addEventListener('change', e=>{ showDots=e.target.checked; draw(); });
    document.getElementById('drawPartition').addEventListener('click', ()=>{ drawArmed=true; });
    document.getElementById('resetPartitions').addEventListener('click', ()=>{ vCuts.clear(); hCuts.clear(); draw(); });
    document.getElementById('toggleAreas').addEventListener('click', ()=>{ showAreas=!showAreas; draw(); });
    document.getElementById('showProduct').addEventListener('click', ()=>{ showProductOnly=!showProductOnly; draw(); });

    draw();
  </script>
</body>
</html>
