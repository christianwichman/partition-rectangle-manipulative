<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Partition Method – Dot Field Rectangle Splitter</title>
<style>
  :root { --bg:#0b0d10; --ui:#11151a; --ink:#e8eef6; --muted:#aeb6c2; --accent:#56a0ff; --accent2:#ffa756; }
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;}
  header{padding:16px 20px;background:var(--ui);position:sticky;top:0;z-index:2;border-bottom:1px solid #1c222a}
  header h1{margin:0;font-size:18px;font-weight:600}
  .wrap{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px}
  @media (max-width: 920px){ .wrap{grid-template-columns:1fr} }
  .panel{background:var(--ui);border:1px solid #1c222a;border-radius:12px;padding:14px}
  .panel h2{margin:0 0 10px 0;font-size:15px;font-weight:600;color:var(--muted)}
  .row{display:grid;grid-template-columns:1fr 100px;gap:8px;align-items:center;margin:8px 0}
  .row > label{font-size:13px;color:var(--ink)}
  input[type="number"], select{
    width:100%;box-sizing:border-box;background:#0f1318;color:var(--ink);
    border:1px solid #1c222a;border-radius:8px;padding:8px 10px;font-size:14px;
  }
  input[type="range"]{width:100%}
  .btns{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  button{
    background:#19202a;color:var(--ink);border:1px solid #263043;border-radius:10px;
    padding:10px 12px;font-size:14px;cursor:pointer
  }
  button:hover{border-color:#36507a}
  #equation{font-variant-numeric:tabular-nums;line-height:1.35;background:#0f1318;border:1px solid #1c222a;border-radius:10px;padding:10px;margin-top:8px}
  .canvasWrap{position:relative;overflow:auto;background:#0a0d11;border:1px solid #1c222a;border-radius:12px;height:70vh;min-height:420px}
  svg{display:block}
  .note{color:var(--muted);font-size:12px;margin-top:8px}
  .legend{display:flex;gap:10px;align-items:center;font-size:12px;color:var(--muted);margin-top:6px}
  .swatch{width:14px;height:14px;border-radius:3px;display:inline-block;border:1px solid #0004}
</style>
</head>
<body>
<header><h1>Partition Method – Rectangles on a Dot Field</h1></header>

<div class="wrap">
  <div class="panel">
    <h2>Controls</h2>
    <div class="row"><label>Dots across (grid columns)</label><input id="gridCols" type="number" min="5" max="50" value="20"></div>
    <div class="row"><label>Dots down (grid rows)</label><input id="gridRows" type="number" min="5" max="50" value="20"></div>

    <hr style="border:0;border-top:1px solid #1c222a;margin:10px 0">

    <div class="row"><label>Rectangle width (columns)</label><input id="rectW" type="number" min="1" value="13"></div>
    <div class="row"><label>Rectangle height (rows)</label><input id="rectH" type="number" min="1" value="3"></div>

    <div class="row">
      <label>Split direction</label>
      <select id="splitDir">
        <option value="vertical">Vertical (split multiplicand)</option>
        <option value="horizontal">Horizontal (split multiplier)</option>
      </select>
    </div>

    <div class="row"><label>Split at (units into the dimension)</label><input id="splitAt" type="number" min="0" value="12"></div>

    <div class="btns">
      <button id="fitSplit12">Set example 3×13 → 12 + 1</button>
      <button id="reset">Reset</button>
      <button id="export">Export PNG</button>
    </div>

    <div id="equation" aria-live="polite"></div>
    <div class="legend">
      <span class="swatch" style="background:#56a0ff66"></span> Left/Top part
      <span class="swatch" style="background:#ffa75666"></span> Right/Bottom part
      <span class="swatch" style="background:#ffffff; border:1px solid #1c222a"></span> Dots / grid
    </div>
    <div class="note">Tip: You can also <b>drag from one dot to another</b> on the canvas to set the rectangle quickly.</div>
  </div>

  <div class="panel canvasWrap">
    <svg id="board" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Dot field with rectangle and partition line"></svg>
  </div>
</div>

<script>
(function(){
  // --- Config ---
  const dotSpacing = 28;  // px between dots
  const dotRadius  = 2.8;
  const pad        = 30;  // outer padding

  // Elements
  const svg = document.getElementById('board');
  const gridCols = document.getElementById('gridCols');
  const gridRows = document.getElementById('gridRows');
  const rectW    = document.getElementById('rectW');
  const rectH    = document.getElementById('rectH');
  const splitDir = document.getElementById('splitDir');
  const splitAt  = document.getElementById('splitAt');
  const equation = document.getElementById('equation');
  const btnReset = document.getElementById('reset');
  const btnExport= document.getElementById('export');
  const btnEx    = document.getElementById('fitSplit12');

  // State
  let cols = +gridCols.value;
  let rows = +gridRows.value;
  let w    = +rectW.value;
  let h    = +rectH.value;
  let split = 'vertical';
  let sAt = +splitAt.value; // position for split (columns if vertical, rows if horizontal)
  let dragInfo = null;      // for drag-to-select rectangle

  // Helpers
  const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));
  const snapToGrid = (x,y)=>({
    c: clamp(Math.round((x - pad)/dotSpacing), 0, cols-1),
    r: clamp(Math.round((y - pad)/dotSpacing), 0, rows-1)
  });

  function sizeSVG(){
    const width  = pad*2 + (cols-1)*dotSpacing;
    const height = pad*2 + (rows-1)*dotSpacing;
    svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
    svg.setAttribute('width', width);
    svg.setAttribute('height', height);
  }

  function draw(){
    cols = clamp(+gridCols.value,5,50);
    rows = clamp(+gridRows.value,5,50);
    w    = clamp(+rectW.value,1,cols);
    h    = clamp(+rectH.value,1,rows);
    split = splitDir.value;
    // split bounds: cannot exceed width/height
    sAt = clamp(+splitAt.value, 0, (split==='vertical'? w : h));

    // Resize SVG
    sizeSVG();

    // Clear
    while (svg.firstChild) svg.removeChild(svg.firstChild);

    // Draw subtle cell background to help area perception
    const cellGroup = document.createElementNS('http://www.w3.org/2000/svg','g');
    cellGroup.setAttribute('opacity','0.18');
    for(let rr=0; rr<rows-1; rr++){
      for(let cc=0; cc<cols-1; cc++){
        const x = pad + cc*dotSpacing;
        const y = pad + rr*dotSpacing;
        const rect = document.createElementNS('http://www.w3.org/2000/svg','rect');
        rect.setAttribute('x', x);
        rect.setAttribute('y', y);
        rect.setAttribute('width', dotSpacing);
        rect.setAttribute('height', dotSpacing);
        rect.setAttribute('fill', '#ffffff');
        rect.setAttribute('fill-opacity', ((rr< h && cc< w) ? 0.10 : 0.04));
        cellGroup.appendChild(rect);
      }
    }
    svg.appendChild(cellGroup);

    // Draw shaded partition halves inside the chosen rectangle
    const areaGroup = document.createElementNS('http://www.w3.org/2000/svg','g');
    if (split==='vertical'){
      const leftW = sAt;            // first part width
      const rightW = w - sAt;       // second part width
      if (leftW>0){
        const rectL = document.createElementNS('http://www.w3.org/2000/svg','rect');
        rectL.setAttribute('x', pad);
        rectL.setAttribute('y', pad);
        rectL.setAttribute('width', Math.max(0,leftW-0)*dotSpacing);
        rectL.setAttribute('height', Math.max(0,h-0)*dotSpacing);
        rectL.setAttribute('fill', '#56a0ff');
        rectL.setAttribute('fill-opacity','0.40');
        areaGroup.appendChild(rectL);
      }
      if (rightW>0){
        const rectR = document.createElementNS('http://www.w3.org/2000/svg','rect');
        rectR.setAttribute('x', pad + sAt*dotSpacing);
        rectR.setAttribute('y', pad);
        rectR.setAttribute('width', Math.max(0,rightW-0)*dotSpacing);
        rectR.setAttribute('height', Math.max(0,h-0)*dotSpacing);
        rectR.setAttribute('fill', '#ffa756');
        rectR.setAttribute('fill-opacity','0.40');
        areaGroup.appendChild(rectR);
      }
      // partition line
      const line = document.createElementNS('http://www.w3.org/2000/svg','line');
      const x = pad + sAt*dotSpacing;
      line.setAttribute('x1', x); line.setAttribute('x2', x);
      line.setAttribute('y1', pad); line.setAttribute('y2', pad + (h-1)*dotSpacing);
      line.setAttribute('stroke', '#ffd7a8'); line.setAttribute('stroke-width','2');
      areaGroup.appendChild(line);

    } else {
      const topH = sAt;
      const botH = h - sAt;
      if (topH>0){
        const rectT = document.createElementNS('http://www.w3.org/2000/svg','rect');
        rectT.setAttribute('x', pad);
        rectT.setAttribute('y', pad);
        rectT.setAttribute('width', Math.max(0,w-0)*dotSpacing);
        rectT.setAttribute('height', Math.max(0,topH-0)*dotSpacing);
        rectT.setAttribute('fill', '#56a0ff');
        rectT.setAttribute('fill-opacity','0.40');
        areaGroup.appendChild(rectT);
      }
      if (botH>0){
        const rectB = document.createElementNS('http://www.w3.org/2000/svg','rect');
        rectB.setAttribute('x', pad);
        rectB.setAttribute('y', pad + sAt*dotSpacing);
        rectB.setAttribute('width', Math.max(0,w-0)*dotSpacing);
        rectB.setAttribute('height', Math.max(0,botH-0)*dotSpacing);
        rectB.setAttribute('fill', '#ffa756');
        rectB.setAttribute('fill-opacity','0.40');
        areaGroup.appendChild(rectB);
      }
      // partition line
      const line = document.createElementNS('http://www.w3.org/2000/svg','line');
      const y = pad + sAt*dotSpacing;
      line.setAttribute('x1', pad); line.setAttribute('x2', pad + (w-1)*dotSpacing);
      line.setAttribute('y1', y);   line.setAttribute('y2', y);
      line.setAttribute('stroke', '#ffd7a8'); line.setAttribute('stroke-width','2');
      areaGroup.appendChild(line);
    }
    svg.appendChild(areaGroup);

    // Draw outer rectangle border (snapped to dots)
    const border = document.createElementNS('http://www.w3.org/2000/svg','rect');
    border.setAttribute('x', pad);
    border.setAttribute('y', pad);
    border.setAttribute('width', Math.max(0,(w-1))*dotSpacing);
    border.setAttribute('height', Math.max(0,(h-1))*dotSpacing);
    border.setAttribute('fill','none');
    border.setAttribute('stroke','#56a0ff');
    border.setAttribute('stroke-width','2.2');
    svg.appendChild(border);

    // Dots
    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const cx = pad + c*dotSpacing;
        const cy = pad + r*dotSpacing;
        const dot = document.createElementNS('http://www.w3.org/2000/svg','circle');
        dot.setAttribute('cx', cx);
        dot.setAttribute('cy', cy);
        dot.setAttribute('r', dotRadius);
        dot.setAttribute('fill', '#ffffff');
        g.appendChild(dot);
      }
    }
    svg.appendChild(g);

    // Axis labels (optional)
    addLabelText();

    // Equation readout
    const total = w*h;
    if (split==='vertical'){
      const a = sAt, b = w - sAt;
      const p1 = h*a, p2 = h*b;
      equation.innerHTML =
        `<div><b>Product:</b> ${h} × ${w} = <b>${total}</b></div>`+
        `<div>Partition: ${h} × ${w} = (${h} × ${a}) + (${h} × ${b}) = ${p1} + ${p2} = <b>${total}</b></div>`;
    } else {
      const a = sAt, b = h - sAt;
      const p1 = w*a, p2 = w*b;
      equation.innerHTML =
        `<div><b>Product:</b> ${h} × ${w} = <b>${total}</b></div>`+
        `<div>Partition: ${h} × ${w} = (${a} × ${w}) + (${b} × ${w}) = ${p1} + ${p2} = <b>${total}</b></div>`;
    }
  }

  function addLabelText(){
    // size markers along the top and left for the current rectangle
    const labelGroup = document.createElementNS('http://www.w3.org/2000/svg','g');
    labelGroup.setAttribute('font-size','12');
    labelGroup.setAttribute('fill','#e8eef6');

    // top width label
    const tx = pad + ((w-1)*dotSpacing)/2;
    const ty = pad - 10;
    const t = document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x', tx);
    t.setAttribute('y', Math.max(12,ty));
    t.setAttribute('text-anchor','middle');
    t.textContent = `${w}`;
    labelGroup.appendChild(t);

    // left height label
    const lx = pad - 10;
    const ly = pad + ((h-1)*dotSpacing)/2 + 4;
    const t2 = document.createElementNS('http://www.w3.org/2000/svg','text');
    t2.setAttribute('x', Math.max(10,lx));
    t2.setAttribute('y', ly);
    t2.setAttribute('text-anchor','middle');
    t2.textContent = `${h}`;
    labelGroup.appendChild(t2);

    svg.appendChild(labelGroup);
  }

  // Drag-to-define rectangle (start and end at dots)
  svg.addEventListener('pointerdown', (e)=>{
    const pt = svg.createSVGPoint();
    pt.x = e.clientX; pt.y = e.clientY;
    const p = pt.matrixTransform(svg.getScreenCTM().inverse());
    const sn = snapToGrid(p.x,p.y);
    dragInfo = { startC: sn.c, startR: sn.r };
  });

  window.addEventListener('pointerup', (e)=>{
    if(!dragInfo) return;
    const pt = svg.createSVGPoint();
    pt.x = e.clientX; pt.y = e.clientY;
    const p = pt.matrixTransform(svg.getScreenCTM().inverse());
    const sn = snapToGrid(p.x,p.y);
    const minC = Math.min(dragInfo.startC, sn.c);
    const maxC = Math.max(dragInfo.startC, sn.c);
    const minR = Math.min(dragInfo.startR, sn.r);
    const maxR = Math.max(dragInfo.startR, sn.r);

    // width/height are counts of dots along each dimension
    const newW = (maxC - minC) + 1;
    const newH = (maxR - minR) + 1;

    rectW.value = clamp(newW,1,cols);
    rectH.value = clamp(newH,1,rows);

    // keep split within bounds
    splitAt.value = clamp(+splitAt.value, 0, (splitDir.value==='vertical'? +rectW.value : +rectH.value));
    dragInfo = null;
    draw();
  });

  // Inputs handlers
  [gridCols,gridRows,rectW,rectH,splitDir,splitAt].forEach(el=> el.addEventListener('input', draw));

  btnReset.addEventListener('click', ()=>{
    gridCols.value = 20; gridRows.value = 20;
    rectW.value = 13; rectH.value = 3;
    splitDir.value = 'vertical';
    splitAt.value = 12;
    draw();
  });

  btnEx.addEventListener('click', ()=>{
    rectH.value = 3; rectW.value = 13;
    splitDir.value = 'vertical';
    splitAt.value = 12; // 12 + 1
    draw();
  });

  btnExport.addEventListener('click', ()=>{
    // Render SVG to canvas and save
    const serializer = new XMLSerializer();
    const src = serializer.serializeToString(svg);
    const img = new Image();
    const svgBlob = new Blob([src], {type:'image/svg+xml;charset=utf-8'});
    const url = URL.createObjectURL(svgBlob);
    img.onload = function(){
      const canvas = document.createElement('canvas');
      canvas.width = svg.viewBox.baseVal.width;
      canvas.height = svg.viewBox.baseVal.height;
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#0a0d11'; ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(img,0,0);
      URL.revokeObjectURL(url);
      canvas.toBlob((blob)=>{
        const dl = document.createElement('a');
        dl.download = `partition_${rectH.value}x${rectW.value}.png`;
        dl.href = URL.createObjectURL(blob);
        dl.click();
      });
    };
    img.src = url;
  });

  // Initial draw
  draw();
})();
</script>
</body>
</html>
